<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex</title>
    <link rel="stylesheet" href="forex-styles.css">
</head>

<body>
    <div class="sidebar">
        <img id="profile-img" src="img/default.png" alt="Profile Picture">
        <p id="username"></p>
        <p id="capital"></p>

        <ul id="currency-list">
            <li>EUR/USD</li>
            <li>GBP/USD</li>
            <li>USD/JPY</li>
        </ul>
    </div>

    <div class="main-content">
        <h2 id="currency-title">TrForex</h2>
        <div id="forex-data">
        </div>
        
    </div>
    <div class="table">
        <table>
            <caption>Forex Data</caption>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Apertura</th>
                    <th>Massimo</th>
                    <th>Minimo</th>
                    <th>Chiusura</th>
                </tr>
            </thead>
            <tbody id="forex-table">
            </tbody>
        </table>
    </div>

    
    <script>
        window.onload = function () {
            const username = localStorage.getItem('username') || "Utente";
            const capital = localStorage.getItem('capital') || "â‚¬10000";

            document.getElementById('username').textContent = username;
            document.getElementById('capital').textContent = capital;

            const images = ['img1.png', 'img2.png', 'img3.png'];
            const randomImage = images[Math.floor(Math.random() * images.length)];

            document.getElementById('profile-img').src = `img/${randomImage}`;
        };

        const currencyList = document.getElementById('currency-list');
        const forexDataDiv = document.getElementById('forex-data');

        function displayData(data) {
            forexDataDiv.innerHTML = ''; // Svuota il contenuto precedente
            if (data.length === 0) {
                forexDataDiv.innerHTML = '<p>Nessun dato trovato per questa valuta.</p>';
                return;
            }

            const table = document.createElement('table');
            table.innerHTML = `
                <tr>
                    <th>Timestamp</th>
                    <th>Apertura</th>
                    <th>Massimo</th>
                    <th>Minimo</th>
                    <th>Chiusura</th>
                </tr>
            `;

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.t}</td>
                    <td>${row.o}</td>
                    <td>${row.h}</td>
                    <td>${row.l}</td>
                    <td>${row.c}</td>
                `;
                table.appendChild(tr);
            });

            forexDataDiv.appendChild(table);
        }

        function fetchForexData(valuta) {
            fetch('/get-forex-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ valuta })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    updateTable(result.data); // Popola la tabella con i dati
                } else {
                    alert(result.message);
                }
            })
            .catch(error => console.error('Errore:', error));
        }

        function updateTable(data) {
            const tableBody = document.getElementById('forex-table');
            tableBody.innerHTML = ''; 

            data.forEach(row => {
                const tr = document.createElement('tr');

                tr.innerHTML = `
                    <td>${row.giorno}</td>
                    <td>${row.open}</td>
                    <td>${row.massimo}</td>
                    <td>${row.minimo}</td>
                    <td>${row.close}</td>
                `;

                tableBody.appendChild(tr);
            });
        }

        currencyList.addEventListener('click', function (e) {
            if (e.target.tagName === 'LI') {
                const selectedCurrency = e.target.textContent;
                document.getElementById('currency-title').textContent = selectedCurrency;
                fetchForexData(selectedCurrency);
            }
        });
    </script>
</body>

</html>
